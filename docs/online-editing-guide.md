# WebNote 在线编辑功能使用指南

WebNote 提供了便捷的在线编辑功能，让您无需离开浏览器即可创建、编辑和管理笔记。本指南将详细介绍如何在不同环境下使用在线编辑功能。

## 模式说明

WebNote 有三种运行模式，每种模式下在线编辑功能的行为略有不同：

### 1. 生产模式（Production）

这是您访问已部署网站（如 GitHub Pages）时的模式。

- **特点**：编辑内容会直接提交到 GitHub 仓库
- **工作流程**：编辑 → 保存 → GitHub 提交 → 自动触发构建部署
- **适用场景**：正式发布内容，需要立即更新网站
- **访问方式**：通过 `https://您的用户名.github.io/WebNote/` 访问
- **环境检测**：系统会自动检测您处于生产环境，顶部会显示"生产环境"标识

### 2. 开发模式（Development）

当您运行 `npm run docs:dev` 时的本地开发环境。

- **特点**：可以实时预览更改，但不会自动提交到 GitHub
- **工作流程**：编辑 → 保存到本地暂存 → 实时预览（不触发部署）
- **适用场景**：调试和测试新功能，实验性编辑
- **访问方式**：通常通过 `http://localhost:5173/WebNote/` 访问
- **环境检测**：系统会在编辑界面顶部显示"开发环境"警告标识
- **注意**：在此模式下的更改不会自动同步到生产环境，需要手动推送
- **实时反馈**：修改后立即可见，无需刷新页面

### 3. 预览模式（Preview）

当您运行 `npm run docs:preview` 时的本地预览环境。

- **特点**：预览构建后的静态站点，不会自动提交到 GitHub
- **工作流程**：与开发模式类似，但使用已构建的静态文件
- **适用场景**：检查构建后的站点效果
- **访问方式**：通常通过 `http://localhost:4173/WebNote/` 访问
- **环境检测**：系统会在编辑界面顶部显示"预览环境"标识
- **注意**：同样不会自动同步更改到生产环境
- **与开发模式区别**：预览模式下查看的是已构建的静态文件，更接近实际部署效果

### 本地编辑与远程部署的关系

当您在本地通过 VS Code 编辑文件并推送到 GitHub 时：

1. **推送流程**：编辑 → 提交 → 推送到 GitHub
2. **自动部署**：一旦推送到 GitHub 的 main 分支，GitHub Actions 会自动触发构建和部署
3. **无需手动构建**：您不需要在本地运行 `npm run docs:build`，GitHub Actions 会处理这一步骤
4. **部署时间**：通常需要1-3分钟完成构建和部署
5. **部署日志**：可以在 GitHub 仓库的 Actions 标签页查看部署进度

## 访问授权与GitHub集成

### GitHub用户菜单

WebNote顶部导航栏右侧提供了GitHub集成的用户菜单：

1. **访问方式**：
   - 将鼠标悬停在顶部导航栏右侧的GitHub图标上
   - 点击GitHub图标也可以显示/隐藏菜单
   - 下拉菜单会显示可用选项
   
2. **未登录状态选项**：
   - GitHub登录：打开登录表单
   - 查看仓库：跳转到项目GitHub仓库
   
3. **已登录状态选项**：
   - 退出登录：注销当前GitHub账户
   - 查看仓库：跳转到项目GitHub仓库
   - 同步更改：与远程仓库同步更改

### 个人访问令牌(PAT)

WebNote 使用 GitHub 个人访问令牌(Personal Access Token, PAT)来授权应用访问您的 GitHub 仓库。

#### 什么是个人访问令牌(PAT)?

- **定义**：个人访问令牌(PAT)是GitHub提供的一种身份验证凭据，用来替代密码访问GitHub API
- **优势**：比直接使用用户名和密码更安全，可以设置具体的权限范围和有效期
- **兼容2FA**：支持两因素认证(2FA)，即使您的GitHub账户启用了2FA，PAT仍然可以正常工作

#### 如何创建个人访问令牌

1. 登录您的GitHub账户
2. 点击右上角头像，选择"Settings"(设置)
3. 在左侧菜单栏中选择"Developer settings"(开发者设置)
4. 选择"Personal access tokens"(个人访问令牌)，然后点击"Generate new token"(生成新令牌)
5. 给令牌添加描述，例如"WebNote访问令牌"
6. 选择所需权限范围，WebNote需要的最小权限是`repo`(完整的仓库访问权限)
7. 点击"Generate token"(生成令牌)
8. **重要**：复制生成的令牌并保存在安全的地方，因为令牌只会显示一次

#### 在WebNote中使用PAT

1. 在WebNote中点击"登录GitHub"按钮
2. 系统会提示您输入GitHub用户名、仓库名和个人访问令牌
3. 填入相关信息并点击"登录"
4. 登录成功后，WebNote将可以读取和更新您的仓库内容

#### 安全提示

- 为WebNote创建专用的访问令牌，而不是共用于其他应用
- 定期轮换您的访问令牌(建议每3-6个月更换一次)
- 如发现异常，及时在GitHub中撤销令牌
- 令牌的权限设置遵循最小权限原则，只授予必要的权限

## 功能使用指南

### 编辑现有笔记

1. 点击页面顶部导航栏上的"编辑当前笔记"按钮
2. 系统会立即进入编辑模式并自动加载当前笔记内容
3. 在编辑器中修改内容
4. 点击工具栏上的"保存"按钮
   - 在生产模式下：会提示输入提交信息，然后提交到 GitHub
   - 在开发/预览模式下：只会保存到本地暂存

**编辑按钮说明**：
- **位置**：编辑按钮集成在顶部导航栏中，与其他操作共存，避免界面混乱
- **移动端**：在小屏幕上自动适配为图标形式，节省空间
- **首页**：首页不显示编辑按钮，保持欢迎页面的整洁
- **当前笔记**：编辑按钮文本已更新为"编辑当前笔记"，更加明确功能

### 创建新笔记

有三种方式创建新笔记：

1. **通过侧边栏顶部操作栏**（VSCode 风格）：
   - 侧边栏顶部操作栏提供了快捷创建按钮
   - 点击"📄"图标（新建笔记按钮）
   - 填写笔记标题、路径和选择模板
   - 点击"创建"按钮

2. **通过文件夹悬停加号**：
   - 将鼠标悬停在侧边栏的文件夹上
   - 文件夹右侧会出现"+"图标（用于新建笔记）
   - 点击"+"图标后会出现输入框
   - 输入文件名（无需添加 .md 后缀，系统会自动添加）
   - 按回车确认创建，或按 ESC/点击其他区域取消
   - 如果输入为空，不会创建文档
   
3. **通过右键菜单**：
   - 在侧边栏的文件夹上右键点击
   - 选择"新建笔记"选项
   - 输入文件名并确认

### 创建新文件夹

1. **通过侧边栏顶部操作栏**（VSCode 风格）：
   - 侧边栏顶部操作栏提供了快捷创建按钮
   - 点击"📁"图标（新建文件夹按钮）
   - 填写文件夹名称和路径
   - 点击"创建"按钮

2. **通过文件夹悬停菜单**：
   - 将鼠标悬停在侧边栏的文件夹上
   - 文件夹右侧会出现"📁+"图标（用于新建文件夹）
   - 点击此图标后会出现输入框
   - 输入文件夹名称
   - 按回车确认创建，或按 ESC/点击其他区域取消
   - 如果输入为空，不会创建文件夹

### 侧边栏顶部操作栏（VSCode风格）

WebNote现在在侧边栏顶部添加了简洁的VSCode风格操作栏：

1. **操作按钮**：
   - � 新建文件：快速创建新的笔记文件
   - 📁 新建文件夹：创建新的文件夹

2. **位置与风格**：
   - 位于侧边栏的最顶部，方便快速访问
   - 采用与VSCode类似的简洁图标设计
   - 自动适应浅色和深色主题

3. **使用优势**：
   - 无需打开菜单或右键即可执行常用操作
   - 统一的操作入口，符合开发者习惯
   - 比原侧边栏菜单更高效、更直观

### 使用右键菜单（VSCode风格）

您现在可以通过右键点击侧边栏中的文件或文件夹来执行操作：

1. **右键点击文件/文件夹**：
   - 显示上下文菜单，提供以下选项：
     - 新建笔记（仅对文件夹）
     - 新建文件夹（仅对文件夹）
     - 重命名
     - 删除
   
2. **快速操作**：
   - 无需打开侧边栏菜单，直接通过右键执行常用操作
   - 重命名和删除操作需要 GitHub 授权
   - 对于删除操作会先确认以防止误操作

### 冲突解决改进

当检测到文件有远程更新时，现在提供了更强大的冲突解决工具：

1. **可视化差异比较**：
   - 分割视图：左右对比本地与远程版本
   - 统一视图：以统一格式查看所有差异
   - 高亮显示新增和删除的内容

2. **多种解决方案**：
   - 使用本地版本：保留您的更改，覆盖远程版本
   - 使用远程版本：放弃本地更改，使用远程最新内容
   - 查看差异后决定：比较两个版本的内容再做决定

3. **简化的冲突处理流程**：
   - 自动检测冲突并提示
   - 可视化界面，无需手动编辑合并标记
   - 解决冲突后自动继续编辑流程

### 移动设备体验优化

为移动设备用户提供了更好的使用体验：

1. **软键盘适配**：
   - 软键盘弹出时自动调整布局，避免内容被遮挡
   - 正在编辑的文本框会自动滚动到可见区域
   - 适当的输入字体大小，避免iOS自动缩放

2. **触摸友好操作**：
   - 按钮尺寸优化，更容易点击
   - 操作间距适当增加，减少误触
   - 响应式布局，在不同屏幕尺寸下自动调整

3. **横竖屏适配**：
   - 自动调整布局适应屏幕方向变化
   - 横屏模式下提供更多工具栏功能
   - 竖屏模式下精简界面，专注于内容

### 同步与冲突处理

1. **同步远程更改**：
   - 点击顶部工具栏的"同步"按钮
   - 系统会拉取远程仓库的最新更改
   - 如果有文件更新，会在界面上显示提示

2. **冲突检测**：
   - 系统使用 SHA 值比较本地和远程文件版本
   - 当检测到文件有远程更新时，会在编辑前提示
   - 您可以选择继续编辑或先同步远程更改
   - 建议先同步再编辑，避免覆盖他人更改

3. **冲突解决流程**：
   - 当系统检测到冲突时，会显示警告消息
   - 提供选项：使用远程版本、使用本地版本、手动合并
   - 手动合并时，系统会显示两个版本的差异，帮助您决定保留哪些内容
   - 解决冲突后点击"保存"，会生成新的提交

### 本地暂存功能

无论在哪种模式下，编辑的内容都会自动保存到浏览器的本地存储中：

- **自动保存**：默认每隔 2 秒自动保存一次
- **草稿箱**：在侧边栏的"草稿箱"中可以查看所有本地保存的草稿
- **恢复草稿**：点击草稿箱中的项目可以恢复之前的编辑
- **最近编辑**：系统记录您最近编辑的文档，方便快速访问
- **离线支持**：即使在没有网络连接的情况下，也可以继续编辑并保存到本地

## 常见问题

### 1. 我在本地 VSCode 编辑并推送到 GitHub，是否需要手动构建？

不需要。当您通过 Git 推送更改到 GitHub 仓库的 main 分支后，GitHub Actions 会自动触发构建和部署。整个流程如下：

1. 在本地 VS Code 中编辑 Markdown 文件
2. 提交更改：`git commit -m "更新内容"`
3. 推送到远程：`git push origin main`
4. GitHub Actions 自动检测到推送
5. 自动运行 `.github/workflows/deploy.yml` 中定义的部署流程
6. 构建完成后，自动部署到 GitHub Pages

您可以在 GitHub 仓库的 Actions 标签页查看构建和部署状态。通常整个过程需要 1-3 分钟完成。

### 2. 本地编辑与在线编辑会冲突吗？

可能会。如果您在本地和在线同时编辑同一文件，可能会导致冲突。建议：

- 在开始编辑前先点击"同步"按钮
- 频繁同步远程变更
- 养成良好的提交习惯，添加清晰的提交信息
- 使用系统提供的冲突检测功能，基于 SHA 值比较

### 3. 为什么我的更改没有立即显示在网站上？

如果您在生产模式下编辑并提交，需要等待 GitHub Actions 完成构建和部署（通常需要几分钟）。

如果您在开发或预览模式下编辑，更改只会保存在本地，不会自动部署到生产环境。您需要将这些更改推送到 GitHub 才能触发部署流程。

### 4. 如何取消编辑？

在编辑模式下，点击"取消"按钮可以放弃当前更改并退出编辑模式。系统会提示您是否确认放弃更改，以防意外操作导致内容丢失。

### 5. 为什么我看不到编辑内容？

如果点击"编辑当前笔记"后无法看到笔记源文件内容，可能有以下原因：

- **未登录GitHub**：在生产模式下，未登录GitHub时可能无法获取文件内容
- **权限问题**：确保您使用的GitHub账号有权访问该仓库
- **网络问题**：检查网络连接，确保能够访问GitHub API
- **文件不存在**：确保正在编辑的文件确实存在于GitHub仓库中

建议先点击顶部导航栏的GitHub图标，选择"GitHub登录"，登录成功后再尝试编辑功能。

### 5. 编辑和新建按钮为什么位置会变化？

编辑按钮的位置会根据不同的设备和页面布局自动调整：

- 在桌面端，按钮默认位于页面右上角
- 当页面有大纲目录时，按钮会自动移到左侧，避免重叠
- 在移动设备上，按钮会移至右下角，提供更好的触摸体验
- 所有这些位置调整都是自动的，无需手动配置

### 6. 个人访问令牌(PAT)安全吗？为什么不用OAuth登录？

个人访问令牌是GitHub提供的官方授权方式之一，安全性取决于您如何管理它：

- **安全性**：PAT本身是安全的，它允许精细的权限控制，且可以随时撤销
- **存储**：WebNote将您的PAT加密存储在浏览器的本地存储中，不会发送到除GitHub API以外的任何服务器
- **与OAuth对比**：
  - PAT更适合个人使用的工具，设置简单直接
  - OAuth需要注册应用并设置回调URL，对于个人工具来说较为复杂
  - PAT支持离线使用，而OAuth通常需要在线验证
- **最佳实践**：创建专门用于WebNote的低权限PAT，并定期更换

### 7. 如果我的PAT过期或无效，会发生什么？

- 系统会提示您"认证失败"或"令牌无效"
- 您需要创建一个新的PAT并重新登录
- 本地编辑的草稿不会丢失，重新授权后仍可访问
- 如遇到授权问题，可点击"注销"后重新登录

### 8. 如何解决文件冲突？

当系统检测到您正在编辑的文件与远程版本不同时，会自动弹出冲突解析器：

1. **查看差异**：
   - 点击"查看差异"按钮可以以分割视图或统一视图查看两个版本的差异
   - 新增的内容以绿色背景显示，删除的内容以红色背景显示

2. **解决冲突**：
   - 使用本地版本：保留您的更改，这将覆盖远程内容
   - 使用远程版本：放弃本地更改，使用远程最新内容
   - 取消：保存本地草稿，稍后再解决冲突

3. **最佳实践**：
   - 在编辑前先点击"同步"按钮
   - 定期提交更改，避免长时间未同步造成大量冲突
   - 协同工作时约定好各自负责的文件或区域

### 9. 如何使用右键菜单？

右键菜单提供了类似 VSCode 的操作体验：

1. **在侧边栏中右键点击**：
   - 文件：可以重命名或删除
   - 文件夹：可以新建文件、新建文件夹、重命名或删除

2. **权限要求**：
   - 查看操作不需要授权
   - 重命名、删除等修改操作需要 GitHub 授权

3. **使用技巧**：
   - 右键菜单比顶部菜单栏更快捷
   - 在嵌套文件夹上右键可以直接在该位置创建新内容
   - 删除操作会有二次确认，防止误操作

## 技巧与建议

1. **使用键盘快捷键**：编辑器支持常见的快捷键，如 Ctrl+B（粗体）、Ctrl+I（斜体）等
2. **分割视图**：点击工具栏的"预览"按钮可以在编辑时实时预览 Markdown 效果
3. **自动保存**：默认启用自动保存，可以点击工具栏上的保存图标切换此功能
4. **定期同步**：养成定期点击"同步"按钮的习惯，保持内容的最新状态
5. **VSCode 风格操作**：
   - 文件夹悬停显示"+"按钮，点击可创建文档或文件夹
   - 右键点击可以快速访问常用操作
   - 输入名称时无需添加扩展名，系统会自动处理
   - 按 ESC 或点击其他区域可取消创建
   - 空名称不会创建任何内容
6. **环境指示器**：
   - 留意编辑器顶部的环境指示器（开发/预览/生产）
   - 不同环境下的保存行为有所不同
7. **移动设备优化**：
   - 在移动设备上使用时，按钮尺寸和位置已优化，方便触摸操作
   - 软键盘弹出时布局会自动调整，避免内容被遮挡
   - 使用横屏模式可以获得更好的编辑体验
8. **冲突处理**：
   - 使用可视化差异比较工具了解更改内容
   - 根据实际情况选择适合的解决方案
   - 合并完成后检查内容，确保没有遗漏或错误

---

希望本指南能帮助您充分利用 WebNote 的在线编辑功能！如有任何问题，请参考文档或联系开发者。
